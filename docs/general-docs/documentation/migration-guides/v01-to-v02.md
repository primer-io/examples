---
title: Migrating from v0.1.x to v0.2.x
sidebar_position: 1
description: Learn how to update your code for the new event system and PrimerJS API
---

# Migrating from v0.1.x to v0.2.x

## Overview

The PrimerJS SDK has undergone significant updates in version 0.2.0 to improve the developer experience, enhance type safety, and prepare for future Core SDK migration. This guide outlines the changes and provides step-by-step migration instructions.

## Key Changes

1. **Event Naming Standardization**: All UI events have been renamed to follow the `primer:*` namespace format
2. **Introduction of PrimerJS Class**: A new typed API surface that replaces direct access to the legacy headless instance
3. **Removal of Checkout Events**: The `primer-oncheckout-complete` and `primer-oncheckout-failure` events have been removed
4. **Consolidated Callbacks**: Payment success and failure callbacks have been unified into a single callback with status indicators

## Event Consolidation Reference

### Event Name Changes

| Old Name                         | New Canonical Name           |
| -------------------------------- | ---------------------------- |
| `primer-state-changed`           | `primer:state-change`        |
| `primer-payment-methods-updated` | `primer:methods-update`      |
| `primer-checkout-initialized`    | `primer:ready`               |
| `primer-card-submit-success`     | `primer:card-success`        |
| `primer-card-submit-errors`      | `primer:card-error`          |
| `primer-card-network-change`     | `primer:card-network-change` |

### Removed Events

The following events have been removed entirely:

- `primer-oncheckout-complete`
- `primer-oncheckout-failure`

## The New PrimerJS API

The PrimerJS class is a type-safe wrapper around the legacy SDK that provides a clean, stable interface for developers.

### Key Methods & Properties

| Method/Property       | Type                                                   | Description                                                               |
| --------------------- | ------------------------------------------------------ | ------------------------------------------------------------------------- |
| `refreshSession()`    | `() => Promise<void>`                                  | Refreshes the client session with merchant backend                        |
| `getPaymentMethods()` | `() => PaymentMethodInfo[]`                            | Returns the current available payment methods                             |
| `onPaymentStart`      | `() => void`                                           | Callback when payment tokenization is about to begin                      |
| `onPaymentPrepare`    | `(data: PaymentData, handler: PrepareHandler) => void` | Intercept point before payment creation with ability to continue or abort |
| `onPaymentComplete`   | `(data: PaymentCompleteData) => void`                  | Unified callback for payment completion, regardless of success or failure |

### Type Definitions

```typescript
// Payment data passed to onPaymentPrepare
interface PaymentData {
  paymentMethodType: string;
}

// Handler for continuing or aborting payment process
interface PrepareHandler {
  continuePaymentCreation: () => void;
  abortPaymentCreation: () => void;
}

// Unified payment completion data with discriminated union pattern
interface PaymentCompleteData {
  payment: Payment;
  status: 'success' | 'pending' | 'error';
  error?: PrimerClientError; // Only present when status is 'error'
}
```

## Migration Guide

Follow these steps to update your integration from v0.1.x to v0.2.x.

### 1. Updating Event Listeners

Update your event listeners to use the new event names:

```javascript
// Before
checkout.addEventListener(
  'primer-checkout-initialized',
  ({ detail: headlessInstance }) => {
    // Using headless instance directly
    console.log('Checkout initialized');
  },
);

// After
checkout.addEventListener('primer:ready', ({ detail: primer }) => {
  // Using the new PrimerJS instance
  console.log('Checkout ready');
});
```

### 2. Handling Payment Lifecycle

Replace separate success/failure handlers with the unified approach:

```javascript
checkout.addEventListener('primer:ready', ({ detail: primer }) => {
  primer.onPaymentComplete = ({ payment, status, error }) => {
    if (status === 'success') {
      console.log('✅ Payment successful', payment);
    } else if (status === 'pending') {
      console.log('⏳ Payment pending', payment);
    } else if (status === 'error') {
      console.error('❌ Payment failed', error);
    }
  };
});
```

### 3. Using onPaymentPrepare Instead of onBeforePaymentCreate

```javascript
checkout.addEventListener('primer:ready', ({ detail: primer }) => {
  primer.onPaymentPrepare = (data, handler) => {
    // Verify something before proceeding
    if (verifyPayment()) {
      handler.continuePaymentCreation();
    } else {
      handler.abortPaymentCreation();
    }
  };
});
```

### 4. Refreshing Client Session

```javascript
// Before
checkout.addEventListener(
  'primer-checkout-initialized',
  ({ detail: headlessInstance }) => {
    document
      .getElementById('refresh-btn')
      .addEventListener('click', async () => {
        await headlessInstance.refreshClientSession();
      });
  },
);

// After
checkout.addEventListener('primer:ready', ({ detail: primer }) => {
  document.getElementById('refresh-btn').addEventListener('click', async () => {
    await primer.refreshSession();
  });
});
```

### 5. Accessing Payment Methods

```javascript
// Before
checkout.addEventListener(
  'primer-payment-methods-updated',
  ({ detail: methods }) => {
    console.log('Available methods:', methods.toArray());
  },
);

// After
checkout.addEventListener('primer:methods-update', ({ detail: methods }) => {
  console.log('Available methods:', methods.toArray());
});

// Or using the PrimerJS instance
checkout.addEventListener('primer:ready', ({ detail: primer }) => {
  const methods = primer.getPaymentMethods();
  console.log('Available methods:', methods);
});
```

## Complete Implementation Example

Here's a complete example that demonstrates the proper usage of the new PrimerJS API:

```html
<primer-checkout id="checkout"></primer-checkout>

<script>
  const checkout = document.getElementById('checkout');

  // Listen for the checkout ready event
  checkout.addEventListener('primer:ready', ({ detail: primer }) => {
    // Configure payment callbacks
    primer.onPaymentStart = () => {
      console.log('Payment flow started');
      showLoadingIndicator();
    };

    primer.onPaymentPrepare = (data, handler) => {
      console.log(`Preparing to create payment with ${data.paymentMethodType}`);

      // Example: Allow the merchant to cancel high-value transactions
      if (isHighValueTransaction()) {
        showConfirmDialog().then((confirmed) => {
          if (confirmed) {
            handler.continuePaymentCreation();
          } else {
            handler.abortPaymentCreation();
          }
        });
      } else {
        // Default behavior: continue payment creation
        handler.continuePaymentCreation();
      }
    };

    primer.onPaymentComplete = ({ payment, status, error }) => {
      hideLoadingIndicator();

      if (status === 'success') {
        console.log('✅ Payment successful', payment.id);
        showSuccessMessage();
      } else if (status === 'pending') {
        console.log('⏳ Payment pending further action', payment.id);
        showPendingMessage();
      } else if (status === 'error') {
        console.error('❌ Payment failed', error.message);
        showErrorMessage(error.message);
      }
    };
  });

  // Listen for state changes to manage UI accordingly
  checkout.addEventListener('primer:state-change', ({ detail: state }) => {
    if (state.isProcessing) {
      showSpinner();
    } else {
      hideSpinner();
    }

    if (state.error) {
      showError(state.error.message);
    }
  });

  // Listen for available payment methods
  checkout.addEventListener('primer:methods-update', ({ detail: methods }) => {
    const methodsList = methods.toArray();
    console.log('Available payment methods:', methodsList);
    updateMethodsDisplay(methodsList);
  });
</script>
```

## Testing Recommendations

We recommend thorough testing of your integration after migration to ensure all payment flows continue to work correctly. Pay special attention to:

1. Event listeners for renamed events
2. Payment completion handling
3. Payment preparation/interception points
4. Session refreshing
5. Payment method retrieval and display

:::tip
Use the browser console to monitor events and ensure they are firing as expected. Add temporary logging to verify that your callbacks are being called with the correct parameters.
:::

## Technical Notes

The v0.2.x implementation:

1. Creates a new `PrimerJS` class that wraps the legacy headless instance
2. Renames DOM events to follow the canonical `primer:*` namespace
3. Removes direct exposure of the headless instance
4. Updates the HeadlessSdkController to create a PrimerJS instance
5. Properly forwards callbacks from the headless instance to the PrimerJS instance
6. Maintains strict type safety throughout
